"use client";

import { useState, useEffect } from "react";
import { DashboardSummary } from "./components/DashboardSummary";
import { VendedoresChart } from "./components/VendedoresChart";
import { VendedoresTable } from "./components/VendedoresTable";
import RankingVendedores from "./components/RankingVendedores";
import { DateRangeSelector } from "./_components/DateRangeSelector";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/app/_components/ui/card";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/app/_components/ui/tabs";
import { format } from "date-fns";
import { ptBR } from "date-fns/locale";
import { VendasExternas } from "@/app/components/VendasExternas";
import { VendasService } from "@/app/_services/vendas";
import { BetelTecnologiaService } from "@/app/_services/betelTecnologia";
import { VendedoresService } from "@/app/_services/vendedores";
import { Vendedor } from "@/app/_services/betelTecnologia";

// Importamos o componente de Produtos Externos
import { ProdutosService } from "@/app/_services/produtos";
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/app/_components/ui/dialog';
import { Badge } from '@/app/_components/ui/badge';
import { Progress } from '@/app/_components/ui/progress';
import { Pagination, PaginationContent, PaginationItem, PaginationNext, PaginationPrevious } from '@/app/_components/ui/pagination';

export default function DashboardVendas() {
  // Inicializa com a data atual e um mês para trás
  const hoje = new Date();
  const mesPassado = new Date();
  mesPassado.setMonth(mesPassado.getMonth() - 1);
  
  const [dateRange, setDateRange] = useState({
    from: mesPassado,
    to: hoje,
  });

  // Estado para armazenar dados reais
  const [dadosSummary, setDadosSummary] = useState({
    faturamento: 0,
    vendas: 0,
    ticketMedio: 0,
  });
  
  // Estado para armazenar dados de vendedores
  const [vendedores, setVendedores] = useState<Vendedor[]>([]);
  
  // Estado para controlar loading
  const [loading, setLoading] = useState(true);
  const [loadingVendedores, setLoadingVendedores] = useState(true);
  const [erro, setErro] = useState<string | null>(null);
  const [erroVendedores, setErroVendedores] = useState<string | null>(null);
  const [vendedorSelecionado, setVendedorSelecionado] = useState<Vendedor | null>(null);
  const [modalAberto, setModalAberto] = useState(false);
  
  // Estados para as vendas do vendedor selecionado
  const [vendasVendedor, setVendasVendedor] = useState<any[]>([]);
  const [loadingVendasVendedor, setLoadingVendasVendedor] = useState(false);
  const [erroVendasVendedor, setErroVendasVendedor] = useState<string | null>(null);
  const [paginaAtual, setPaginaAtual] = useState(1);
  const itensPorPagina = 5;
  
  // Estados para o modal de detalhes da venda
  const [vendaModalAberto, setVendaModalAberto] = useState(false);
  const [vendaSelecionada, setVendaSelecionada] = useState<any | null>(null);
  
  const handleDateRangeChange = async (range: { from: Date; to: Date }) => {
    setDateRange(range);
    console.log(`Buscando dados de ${format(range.from, "dd/MM/yyyy")} até ${format(range.to, "dd/MM/yyyy")}`);
    await fetchDadosDashboard(range.from, range.to);
  };

  // Função para buscar dados reais
  const fetchDadosDashboard = async (dataInicio: Date, dataFim: Date) => {
    try {
      setLoading(true);
      setErro(null);
      setLoadingVendedores(true);
      setErroVendedores(null);
      
      // Buscar vendas externas
      const vendasResponse = await VendasService.buscarVendasExternas({
        dataInicio,
        dataFim
      });
      
      if (vendasResponse.erro) {
        throw new Error(vendasResponse.erro);
      }
      
      // Calcular totais
      const totalVendas = vendasResponse.totalVendas || 0;
      const totalValor = vendasResponse.totalValor || 0;
      const ticketMedio = totalVendas > 0 ? totalValor / totalVendas : 0;
      
      // Atualizar dados do summary
      setDadosSummary({
        faturamento: totalValor,
        vendas: totalVendas,
        ticketMedio: ticketMedio
      });
      
      // Buscar vendedores
      try {
        const vendedoresResponse = await VendedoresService.buscarVendedores({
          dataInicio,
          dataFim
        });
        
        if (vendedoresResponse.erro) {
          throw new Error(vendedoresResponse.erro);
        }
        
        setVendedores(vendedoresResponse.vendedores || []);
      } catch (error) {
        console.error('Erro ao buscar vendedores:', error);
        setErroVendedores(error instanceof Error ? error.message : 'Erro ao buscar vendedores');
      } finally {
        setLoadingVendedores(false);
      }
      
    } catch (error) {
      console.error('Erro ao buscar dados do dashboard:', error);
      setErro(error instanceof Error ? error.message : 'Erro ao buscar dados');
    } finally {
      setLoading(false);
    }
  };

  // Buscar dados iniciais
  useEffect(() => {
    fetchDadosDashboard(dateRange.from, dateRange.to);
  }, []);

  // Função para abrir modal com detalhes do vendedor
  const handleOpenVendedorDetails = (vendedor: Vendedor, index?: number) => {
    // Adicionar posição ao vendedor se não estiver definida
    const vendedorComPosicao = {
      ...vendedor,
      posicao: index !== undefined ? index + 1 : vendedores.findIndex(v => v.id === vendedor.id) + 1
    };
    setVendedorSelecionado(vendedorComPosicao);
    setModalAberto(true);
    
    // Buscar vendas do vendedor
    buscarVendasVendedor(vendedor.id);
    
    // Resetar paginação
    setPaginaAtual(1);
  }
  
  // Função para buscar vendas de um vendedor específico
  const buscarVendasVendedor = async (vendedorId: string) => {
    try {
      setLoadingVendasVendedor(true);
      setErroVendasVendedor(null);
      
      const vendasResponse = await VendasService.buscarVendasPorVendedor({
        dataInicio: dateRange.from,
        dataFim: dateRange.to,
        vendedorId
      });
      
      if (vendasResponse.erro) {
        throw new Error(vendasResponse.erro);
      }
      
      setVendasVendedor(vendasResponse.vendas || []);
    } catch (error) {
      console.error('Erro ao buscar vendas do vendedor:', error);
      setErroVendasVendedor(error instanceof Error ? error.message : 'Erro ao buscar vendas');
    } finally {
      setLoadingVendasVendedor(false);
    }
  };
  
  // Função para abrir modal com detalhes da venda
  const abrirDetalhesVenda = (venda: any) => {
    setVendaSelecionada(venda);
    setVendaModalAberto(true);
    console.log("Detalhes da venda:", venda);
  };
  
  // Calcular índices para paginação
  const indiceInicial = (paginaAtual - 1) * itensPorPagina;
  const indiceFinal = indiceInicial + itensPorPagina;
  const totalPaginas = Math.ceil((vendasVendedor?.length || 0) / itensPorPagina);
  const vendasPaginadas = vendasVendedor.slice(indiceInicial, indiceFinal);
  
  // Funções para navegação de página
  const irParaPaginaAnterior = () => {
    if (paginaAtual > 1) {
      setPaginaAtual(paginaAtual - 1);
    }
  };
  
  const irParaProximaPagina = () => {
    if (paginaAtual < totalPaginas) {
      setPaginaAtual(paginaAtual + 1);
    }
  };
  
  return (
    <div className="container mx-auto px-4 py-6">
      <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
        <div>
          <h1 className="text-2xl font-bold">Dashboard de Vendas</h1>
          <p className="text-muted-foreground">
            Visualize e analise dados de vendas, atendimentos e performance.
          </p>
        </div>
        <div className="flex flex-wrap items-center gap-4">
          <DateRangeSelector onDateRangeChange={handleDateRangeChange} />
        </div>
      </div>

      <div className="grid gap-6">
        {/* Sumário do dashboard */}
        {loading ? (
          <Card className="bg-gradient-to-r from-amber-50 to-amber-100 dark:from-amber-950/30 dark:to-amber-900/20 border-[#faba33]/20">
            <CardContent className="pt-6">
              <div className="flex justify-center items-center h-[100px]">
                <div className="animate-spin rounded-full h-10 w-10 border-b-2 border-[#faba33]"></div>
              </div>
            </CardContent>
          </Card>
        ) : (
          <DashboardSummary totais={dadosSummary} />
        )}
      
        <div className="grid grid-cols-1 gap-6">
          {loadingVendedores ? (
            <Card>
              <CardHeader>
                <CardTitle>Ranking de Vendedores</CardTitle>
                <CardDescription>
                  Carregando dados...
                </CardDescription>
              </CardHeader>
              <CardContent className="h-[500px]">
                <div className="flex items-center justify-center h-full">
                  <div className="text-center">
                    <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-[#faba33] mx-auto mb-4"></div>
                    <p className="text-muted-foreground">Carregando dados de vendedores...</p>
                  </div>
                </div>
              </CardContent>
            </Card>
          ) : erroVendedores ? (
            <Card>
              <CardHeader>
                <CardTitle>Ranking de Vendedores</CardTitle>
                <CardDescription>
                  Erro ao carregar dados
                </CardDescription>
              </CardHeader>
              <CardContent className="h-[500px]">
                <div className="flex items-center justify-center h-full text-red-500">
                  <p>{erroVendedores}</p>
                </div>
              </CardContent>
            </Card>
          ) : (
            <RankingVendedores vendedores={vendedores} titulo="Ranking de Vendedores" />
          )}
          
          <Card>
            <CardHeader>
              <CardTitle>Desempenho de Vendedores</CardTitle>
              <CardDescription>
                Detalhes de vendas e faturamento por vendedor
                </CardDescription>
              </CardHeader>
              <CardContent>
              {loadingVendedores ? (
                <div className="flex items-center justify-center h-[300px]">
                  <div className="text-center">
                    <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-[#faba33] mx-auto mb-4"></div>
                    <p className="text-muted-foreground">Carregando dados de vendedores...</p>
                  </div>
                </div>
              ) : erroVendedores ? (
                <div className="flex items-center justify-center h-[300px] text-red-500">
                  <p>{erroVendedores}</p>
                </div>
              ) : vendedores.length === 0 ? (
                <div className="flex items-center justify-center h-[300px]">
                  <p className="text-muted-foreground">Nenhum vendedor encontrado no período selecionado</p>
                </div>
              ) : (
                <div className="overflow-auto max-h-[500px]">
                  <table className="w-full">
                    <thead>
                      <tr className="border-b text-left">
                        <th className="pb-2">Vendedor</th>
                        <th className="pb-2 text-center">Vendas</th>
                        <th className="pb-2 text-right">Faturamento</th>
                        <th className="pb-2 text-right">Ticket Médio</th>
                      </tr>
                    </thead>
                    <tbody>
                      {vendedores.map((vendedor, index) => (
                        <tr key={index} className="border-b last:border-0 hover:bg-muted/50 cursor-pointer"
                           onClick={() => handleOpenVendedorDetails(vendedor, index)}>
                          <td className="py-3 max-w-[150px] truncate">{vendedor.nome}</td>
                          <td className="py-3 text-center">{vendedor.vendas}</td>
                          <td className="py-3 text-right">
                            {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(vendedor.faturamento)}
                          </td>
                          <td className="py-3 text-right">
                            {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(vendedor.ticketMedio)}
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              )}
              </CardContent>
            </Card>
        </div>
      </div>
      
      {/* Área de debug */}
      <div className="mt-8 p-4 bg-gray-100 rounded-md text-xs">
        <details>
          <summary className="font-semibold cursor-pointer">Debug Info</summary>
          <div className="mt-2">
            <p>Data início: {format(dateRange.from, "dd/MM/yyyy")}</p>
            <p>Data fim: {format(dateRange.to, "dd/MM/yyyy")}</p>
            <p>Faturamento: {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(dadosSummary.faturamento)}</p>
            <p>Vendas: {dadosSummary.vendas}</p>
            <p>Ticket Médio: {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(dadosSummary.ticketMedio)}</p>
            <p>Total Vendedores: {vendedores.length}</p>
          </div>
        </details>
      </div>

      {/* Modal para detalhes do vendedor */}
      <Dialog open={modalAberto} onOpenChange={setModalAberto}>
        <DialogContent className="sm:max-w-[600px]">
          <DialogHeader>
            <DialogTitle className="text-xl font-semibold">
              Detalhes do Vendedor
            </DialogTitle>
          </DialogHeader>
          
          {vendedorSelecionado && (
            <div className="space-y-4 py-4">
              <div className="flex justify-between items-center border-b pb-3">
                <h3 className="text-lg font-medium">{vendedorSelecionado.nome}</h3>
                <Badge variant="outline" className="bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-300">
                  {vendedorSelecionado.posicao}º Lugar
                </Badge>
              </div>
              
              <div className="grid grid-cols-2 gap-4">
                <div className="space-y-2">
                  <p className="text-sm text-muted-foreground">Total de Vendas</p>
                  <p className="text-2xl font-semibold">{vendedorSelecionado.vendas}</p>
                </div>
                
                <div className="space-y-2">
                  <p className="text-sm text-muted-foreground">Faturamento</p>
                  <p className="text-2xl font-semibold">
                    {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(vendedorSelecionado.faturamento)}
                  </p>
                </div>
                
                <div className="space-y-2">
                  <p className="text-sm text-muted-foreground">Ticket Médio</p>
                  <p className="text-2xl font-semibold">
                    {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(vendedorSelecionado.ticketMedio)}
                  </p>
                </div>
                
                <div className="space-y-2">
                  <p className="text-sm text-muted-foreground">% do Faturamento Total</p>
                  <p className="text-2xl font-semibold">
                    {((vendedorSelecionado.faturamento / dadosSummary.faturamento) * 100).toFixed(2)}%
                  </p>
                </div>
              </div>
              
              <div className="pt-3">
                <div className="space-y-2">
                  <div className="flex justify-between text-sm">
                    <span>Performance</span>
                    <span>{vendedorSelecionado.percentual ? vendedorSelecionado.percentual.toFixed(2) : ((vendedorSelecionado.faturamento / dadosSummary.faturamento) * 100).toFixed(2)}%</span>
                  </div>
                  <Progress value={vendedorSelecionado.percentual || ((vendedorSelecionado.faturamento / dadosSummary.faturamento) * 100)} className="h-2 bg-gray-200 dark:bg-gray-700" />
                </div>
              </div>
              
              {/* Lista de Vendas do Vendedor */}
              <div className="pt-6 border-t mt-4">
                <h4 className="text-md font-semibold mb-3">Vendas Realizadas</h4>
                
                {loadingVendasVendedor ? (
                  <div className="flex items-center justify-center h-[150px]">
                    <div className="text-center">
                      <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-[#faba33] mx-auto mb-2"></div>
                      <p className="text-sm text-muted-foreground">Carregando vendas...</p>
                    </div>
                  </div>
                ) : erroVendasVendedor ? (
                  <div className="flex items-center justify-center h-[100px] text-red-500">
                    <p className="text-sm">{erroVendasVendedor}</p>
                  </div>
                ) : vendasVendedor.length === 0 ? (
                  <div className="flex items-center justify-center h-[100px]">
                    <p className="text-sm text-muted-foreground">Nenhuma venda encontrada no período</p>
                  </div>
                ) : (
                  <div className="space-y-4">
                    <div className="overflow-auto max-h-[200px]">
                      <table className="w-full text-sm">
                        <thead className="text-xs bg-muted/30">
                          <tr>
                            <th className="px-2 py-2 text-left">Data</th>
                            <th className="px-2 py-2 text-left">Cliente</th>
                            <th className="px-2 py-2 text-right">Valor</th>
                          </tr>
                        </thead>
                        <tbody className="divide-y">
                          {vendasPaginadas.map((venda, index) => (
                            <tr key={index} className="hover:bg-muted/20 cursor-pointer" onClick={() => abrirDetalhesVenda(venda)}>
                              <td className="px-2 py-2">
                                {venda.data_inclusao 
                                  ? new Date(venda.data_inclusao).toLocaleDateString('pt-BR')
                                  : "Data não disponível"}
                              </td>
                              <td className="px-2 py-2">{venda.cliente || "Cliente não identificado"}</td>
                              <td className="px-2 py-2 text-right">
                                {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(parseFloat(venda.valor_total) || 0)}
                              </td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                    
                    {/* Paginação */}
                    {totalPaginas > 1 && (
                      <Pagination className="mt-2">
                        <PaginationContent>
                          <PaginationItem>
                            <PaginationPrevious 
                              onClick={irParaPaginaAnterior} 
                              className={paginaAtual === 1 ? "pointer-events-none opacity-50" : "cursor-pointer"}
                            />
                          </PaginationItem>
                          <PaginationItem>
                            <span className="text-sm">{paginaAtual} de {totalPaginas}</span>
                          </PaginationItem>
                          <PaginationItem>
                            <PaginationNext 
                              onClick={irParaProximaPagina}
                              className={paginaAtual === totalPaginas ? "pointer-events-none opacity-50" : "cursor-pointer"}
                            />
                          </PaginationItem>
                        </PaginationContent>
                      </Pagination>
                    )}
                  </div>
                )}
              </div>
            </div>
          )}
        </DialogContent>
      </Dialog>

      {/* Adicionar modal para detalhes da venda */}
      <Dialog open={vendaModalAberto} onOpenChange={setVendaModalAberto}>
        <DialogContent className="sm:max-w-[600px]">
          <DialogHeader>
            <DialogTitle className="text-xl font-semibold">Detalhes da Venda</DialogTitle>
          </DialogHeader>

          {vendaSelecionada && (
            <div className="space-y-4 py-4">
              <div className="grid grid-cols-2 gap-4">
                <div className="space-y-2">
                  <p className="text-sm text-muted-foreground">ID da Venda</p>
                  <p className="text-md font-semibold">{vendaSelecionada.id}</p>
                </div>
                <div className="space-y-2">
                  <p className="text-sm text-muted-foreground">Data</p>
                  <p className="text-md font-semibold">
                    {vendaSelecionada.data_inclusao 
                      ? new Date(vendaSelecionada.data_inclusao).toLocaleDateString('pt-BR')
                      : "Data não disponível"}
                  </p>
                </div>
              </div>

              <div className="space-y-2">
                <p className="text-sm text-muted-foreground">Cliente</p>
                <div className="flex items-center gap-2">
                  <p className="text-md font-semibold">{vendaSelecionada.cliente || "Cliente não identificado"}</p>
                  {vendaSelecionada.cliente_id && (
                    <Badge variant="outline">ID: {vendaSelecionada.cliente_id}</Badge>
                  )}
                </div>
              </div>

              <div className="space-y-2">
                <p className="text-sm text-muted-foreground">Vendedor</p>
                <p className="text-md font-semibold">{vendaSelecionada.vendedor_nome || vendedorSelecionado?.nome || "Não especificado"}</p>
              </div>

              <div className="pt-3 border-t">
                <div className="flex justify-between items-center mb-2">
                  <p className="font-semibold">Valor Total</p>
                  <p className="text-xl font-bold text-green-600">
                    {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(parseFloat(vendaSelecionada.valor_total) || 0)}
                  </p>
                </div>
              </div>

              {/* Se tiver itens na venda, exibir a lista de itens */}
              {vendaSelecionada.itens && vendaSelecionada.itens.length > 0 && (
                <div className="pt-3 border-t">
                  <p className="font-semibold mb-2">Itens da Venda</p>
                  <div className="overflow-auto max-h-[200px]">
                    <table className="w-full text-sm">
                      <thead className="text-xs bg-muted/30">
                        <tr>
                          <th className="px-2 py-2 text-left">Produto</th>
                          <th className="px-2 py-2 text-right">Qtde</th>
                          <th className="px-2 py-2 text-right">Valor Unit.</th>
                          <th className="px-2 py-2 text-right">Total</th>
                        </tr>
                      </thead>
                      <tbody className="divide-y">
                        {vendaSelecionada.itens.map((item, idx) => (
                          <tr key={idx} className="hover:bg-muted/20">
                            <td className="px-2 py-2">{item.produto}</td>
                            <td className="px-2 py-2 text-right">{item.quantidade}</td>
                            <td className="px-2 py-2 text-right">
                              {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(parseFloat(item.valor_unitario) || 0)}
                            </td>
                            <td className="px-2 py-2 text-right">
                              {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(parseFloat(item.valor_total) || 0)}
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </div>
              )}

              {/* Exibir campos adicionais que podem vir da API */}
              <div className="pt-3 border-t">
                <p className="font-semibold mb-2">Informações Adicionais</p>
                <div className="bg-muted/20 p-3 rounded-md">
                  <pre className="text-xs overflow-auto max-h-[150px]">
                    {JSON.stringify(
                      Object.fromEntries(
                        Object.entries(vendaSelecionada).filter(([key]) => 
                          !['id', 'cliente', 'cliente_id', 'valor_total', 'data_inclusao', 'vendedor_id', 'vendedor_nome', 'itens'].includes(key)
                        )
                      ), 
                      null, 2
                    )}
                  </pre>
                </div>
              </div>

            </div>
          )}
        </DialogContent>
      </Dialog>
    </div>
  );
}

// Componente para exibir os produtos externos
function ProdutosExternosPanel({ dataInicio, dataFim }: { dataInicio: Date; dataFim: Date }) {
  const [produtos, setProdutos] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);
  const [erro, setErro] = useState<string | null>(null);
  
  useEffect(() => {
    const buscarProdutos = async () => {
      try {
        setLoading(true);
        setErro(null);
        
        // Buscar produtos externos
        const response = await ProdutosService.buscarProdutosExternos({
          dataInicio,
          dataFim
        });
        
        if (response.erro) {
          throw new Error(response.erro);
        }
        
        setProdutos(response.produtos || []);
        console.log('Produtos externos recebidos:', response.produtos?.length || 0);
      } catch (error) {
        console.error('Erro ao buscar produtos externos:', error);
        setErro(error instanceof Error ? error.message : 'Erro ao buscar produtos externos');
      } finally {
        setLoading(false);
      }
    };
    
    buscarProdutos();
  }, [dataInicio, dataFim]);
  
  if (loading) {
    return (
      <div className="flex items-center justify-center h-[300px]">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-[#faba33] mx-auto mb-4"></div>
          <p className="text-muted-foreground">Carregando produtos externos...</p>
        </div>
      </div>
    );
  }
  
  if (erro) {
    return (
      <div className="flex items-center justify-center h-[300px] text-red-500">
        <div className="text-center">
          <div className="text-red-500 text-xl mb-4">⚠️</div>
          <p>{erro}</p>
        </div>
      </div>
    );
  }
  
  if (produtos.length === 0) {
    return (
      <div className="flex items-center justify-center h-[300px]">
        <p className="text-muted-foreground">Nenhum produto externo encontrado no período selecionado</p>
      </div>
    );
  }
  
  return (
    <div className="overflow-auto">
      <table className="w-full">
        <thead>
          <tr className="border-b text-left">
            <th className="pb-2">Produto</th>
            <th className="pb-2">Categoria</th>
            <th className="pb-2 text-right">Preço</th>
            <th className="pb-2 text-right">Qtd</th>
            <th className="pb-2 text-right">Total</th>
          </tr>
        </thead>
        <tbody>
          {produtos.map((produto, index) => (
            <tr key={index} className="border-b last:border-0 hover:bg-muted/50">
              <td className="py-3">{produto.nome}</td>
              <td className="py-3">{produto.categoria || 'N/A'}</td>
              <td className="py-3 text-right">
                {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(produto.precoUnitario)}
              </td>
              <td className="py-3 text-right">{produto.quantidade}</td>
              <td className="py-3 text-right">
                {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(produto.total)}
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
} 